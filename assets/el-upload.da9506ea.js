var me=Object.defineProperty,ve=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var Z=(s,o,t)=>o in s?me(s,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[o]=t,T=(s,o)=>{for(var t in o||(o={}))ge.call(o,t)&&Z(s,t,o[t]);if(Y)for(var t of Y(o))be.call(o,t)&&Z(s,t,o[t]);return s},F=(s,o)=>ve(s,ye(o));import{b7 as G,b8 as he,a2 as A,a3 as m,a4 as H,aB as E,e as K,u as ke,l as q,f as Q,o as g,g as L,w as R,c as U,I as Ee,x as y,ah as a,aV as re,O as C,y as b,a as N,b as P,b9 as $e,C as O,t as x,ak as D,W as Ce,ba as Re,au as we,bb as Se,bc as Ue,bd as Le,J as Pe,be as Te,q as M,bf as Fe,n as _e,bg as J,bh as Oe,L as ee,ad as De,bi as Be,bj as je,bk as Ne,m as te,aS as qe,z as Ae,b2 as He,N as se,P as ae,a6 as Ke}from"./index.d19aa5ca.js";import{E as Me}from"./el-progress.35461c50.js";const ie=Symbol("uploadContextKey"),ze="ElUpload";class Ie extends Error{constructor(o,t,c,d){super(o),this.name="UploadAjaxError",this.status=t,this.method=c,this.url=d}}function ne(s,o,t){let c;return t.response?c=`${t.response.error||t.response}`:t.responseText?c=`${t.responseText}`:c=`fail to ${o.method} ${s} ${t.status}`,new Ie(c,t.status,o.method,s)}function We(s){const o=s.responseText||s.response;if(!o)return o;try{return JSON.parse(o)}catch{return o}}const Ve=s=>{typeof XMLHttpRequest=="undefined"&&G(ze,"XMLHttpRequest is undefined");const o=new XMLHttpRequest,t=s.action;o.upload&&o.upload.addEventListener("progress",i=>{const p=i;p.percent=i.total>0?i.loaded/i.total*100:0,s.onProgress(p)});const c=new FormData;if(s.data)for(const[i,p]of Object.entries(s.data))Array.isArray(p)?c.append(i,...p):c.append(i,p);c.append(s.filename,s.file,s.file.name),o.addEventListener("error",()=>{s.onError(ne(t,s,o))}),o.addEventListener("load",()=>{if(o.status<200||o.status>=300)return s.onError(ne(t,s,o));s.onSuccess(We(o))}),o.open(s.method,t,!0),s.withCredentials&&"withCredentials"in o&&(o.withCredentials=!0);const d=s.headers||{};if(d instanceof Headers)d.forEach((i,p)=>o.setRequestHeader(p,i));else for(const[i,p]of Object.entries(d))he(p)||o.setRequestHeader(i,String(p));return o.send(c),o},ue=["text","picture","picture-card"];let Xe=1;const de=()=>Date.now()+Xe++,ce=A({action:{type:String,default:"#"},headers:{type:m(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>H({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:m(Array),default:()=>H([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ue,default:"text"},httpRequest:{type:m(Function),default:Ve},disabled:Boolean,limit:Number}),Je=A(F(T({},ce),{beforeUpload:{type:m(Function),default:E},beforeRemove:{type:m(Function)},onRemove:{type:m(Function),default:E},onChange:{type:m(Function),default:E},onPreview:{type:m(Function),default:E},onSuccess:{type:m(Function),default:E},onProgress:{type:m(Function),default:E},onError:{type:m(Function),default:E},onExceed:{type:m(Function),default:E}})),Ge=A({files:{type:m(Array),default:()=>H([])},disabled:{type:Boolean,default:!1},handlePreview:{type:m(Function),default:E},listType:{type:String,values:ue,default:"text"}}),Qe={remove:s=>!!s},Ye=["onKeydown"],Ze=["src"],xe=["onClick"],et=["onClick"],tt=["onClick"],st={name:"ElUploadList"},at=K(F(T({},st),{props:Ge,emits:Qe,setup(s,{emit:o}){const t=s,{t:c}=ke(),d=q("upload"),i=q("icon"),p=q("list"),w=Q(!1),S=r=>{t.handlePreview(r)},$=r=>{r.target.focus()},k=r=>{o("remove",r)};return(r,l)=>(g(),L(Te,{tag:"ul",class:y([a(d).b("list"),a(d).bm("list",r.listType),a(d).is("disabled",r.disabled)]),name:a(p).b()},{default:R(()=>[(g(!0),U(Pe,null,Ee(r.files,e=>(g(),U("li",{key:e.uid||e.name,class:y([a(d).be("list","item"),a(d).is(e.status),{focusing:w.value}]),tabindex:"0",onKeydown:re(n=>!r.disabled&&k(e),["delete"]),onFocus:l[0]||(l[0]=n=>w.value=!0),onBlur:l[1]||(l[1]=n=>w.value=!1),onClick:$},[C(r.$slots,"default",{file:e},()=>[r.listType==="picture"||e.status!=="uploading"&&r.listType==="picture-card"?(g(),U("img",{key:0,class:y(a(d).be("list","item-thumbnail")),src:e.url,alt:""},null,10,Ze)):b("v-if",!0),r.listType!=="picture"&&(e.status==="uploading"||r.listType!=="picture-card")?(g(),U("div",{key:1,class:y(a(d).be("list","item-info"))},[N("a",{class:y(a(d).be("list","item-name")),onClick:D(n=>S(e),["prevent"])},[P(a(O),{class:y(a(i).m("document"))},{default:R(()=>[P(a($e))]),_:1},8,["class"]),N("span",{class:y(a(d).be("list","item-file-name"))},x(e.name),3)],10,xe),e.status==="uploading"?(g(),L(a(Me),{key:0,type:r.listType==="picture-card"?"circle":"line","stroke-width":r.listType==="picture-card"?6:2,percentage:Number(e.percentage),style:Ce(r.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):b("v-if",!0)],2)):b("v-if",!0),N("label",{class:y(a(d).be("list","item-status-label"))},[r.listType==="text"?(g(),L(a(O),{key:0,class:y([a(i).m("upload-success"),a(i).m("circle-check")])},{default:R(()=>[P(a(Re))]),_:1},8,["class"])):["picture-card","picture"].includes(r.listType)?(g(),L(a(O),{key:1,class:y([a(i).m("upload-success"),a(i).m("check")])},{default:R(()=>[P(a(we))]),_:1},8,["class"])):b("v-if",!0)],2),r.disabled?b("v-if",!0):(g(),L(a(O),{key:2,class:y(a(i).m("close")),onClick:n=>k(e)},{default:R(()=>[P(a(Se))]),_:2},1032,["class","onClick"])),b(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),b(" This is a bug which needs to be fixed "),b(" TODO: Fix the incorrect navigation interaction "),r.disabled?b("v-if",!0):(g(),U("i",{key:3,class:y(a(i).m("close-tip"))},x(a(c)("el.upload.deleteTip")),3)),r.listType==="picture-card"?(g(),U("span",{key:4,class:y(a(d).be("list","item-actions"))},[N("span",{class:y(a(d).be("list","item-preview")),onClick:n=>r.handlePreview(e)},[P(a(O),{class:y(a(i).m("zoom-in"))},{default:R(()=>[P(a(Ue))]),_:1},8,["class"])],10,et),r.disabled?b("v-if",!0):(g(),U("span",{key:0,class:y(a(d).be("list","item-delete")),onClick:n=>k(e)},[P(a(O),{class:y(a(i).m("delete"))},{default:R(()=>[P(a(Le))]),_:1},8,["class"])],10,tt))],2)):b("v-if",!0)])],42,Ye))),128)),C(r.$slots,"append")]),_:3},8,["class","name"]))}}));var oe=M(at,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const nt=A({disabled:{type:Boolean,default:!1}}),ot={file:s=>Fe(s)},lt=["onDrop","onDragover"],rt={name:"ElUploadDrag"},it=K(F(T({},rt),{props:nt,emits:ot,setup(s,{emit:o}){const t=s,c="ElUploadDrag",d=_e(ie);d||G(c,"usage: <el-upload><el-upload-dragger /></el-upload>");const i=q("upload"),p=Q(!1),w=$=>{if(t.disabled)return;p.value=!1;const k=Array.from($.dataTransfer.files),r=d.accept.value;if(!r){o("file",k);return}const l=k.filter(e=>{const{type:n,name:f}=e,v=f.includes(".")?`.${f.split(".").pop()}`:"",u=n.replace(/\/.*$/,"");return r.split(",").map(h=>h.trim()).filter(h=>h).some(h=>h.startsWith(".")?v===h:/\/\*$/.test(h)?u===h.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(h)?n===h:!1)});o("file",l)},S=()=>{t.disabled||(p.value=!0)};return($,k)=>(g(),U("div",{class:y([a(i).b("dragger"),a(i).is("dragover",p.value)]),onDrop:D(w,["prevent"]),onDragover:D(S,["prevent"]),onDragleave:k[0]||(k[0]=D(r=>p.value=!1,["prevent"]))},[C($.$slots,"default")],42,lt))}}));var ut=M(it,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const dt=A(F(T({},ce),{fileList:{type:m(Array),default:()=>H([])},beforeUpload:{type:m(Function),default:E},onRemove:{type:m(Function),default:E},onStart:{type:m(Function),default:E},onSuccess:{type:m(Function),default:E},onProgress:{type:m(Function),default:E},onError:{type:m(Function),default:E},onExceed:{type:m(Function),default:E}})),ct=["onKeydown"],pt=["name","multiple","accept"],ft={name:"ElUploadContent",inheritAttrs:!1},mt=K(F(T({},ft),{props:dt,setup(s,{expose:o}){const t=s,c=q("upload"),d=J({}),i=J(),p=e=>{if(e.length===0)return;const{autoUpload:n,limit:f,fileList:v,multiple:u,onStart:h,onExceed:_}=t;if(f&&v.length+e.length>f){_(e,v);return}u||(e=e.slice(0,1));for(const z of e){const B=z;B.uid=de(),h(B),n&&w(B)}},w=async e=>{if(i.value.value="",!t.beforeUpload)return S(e);let n;try{n=await t.beforeUpload(e)}catch{n=!1}if(n===!1){t.onRemove(e);return}let f=e;if(n instanceof Blob){n instanceof File?f=n:f=new File([n],e.name,{type:e.type});for(const v of Object.keys(e))f[v]=e[v]}S(e)},S=e=>{const{headers:n,data:f,method:v,withCredentials:u,name:h,action:_,onProgress:z,onSuccess:B,onError:pe,httpRequest:fe}=t,{uid:I}=e,W={headers:n||{},withCredentials:u,file:e,data:f,method:v,filename:h,action:_,onProgress:j=>{z(j,e)},onSuccess:j=>{B(j,e),delete d.value[I]},onError:j=>{pe(j,e),delete d.value[I]}},V=fe(W);d.value[I]=V,V instanceof Promise&&V.then(W.onSuccess,W.onError)},$=e=>{const n=e.target.files;!n||p(Array.from(n))},k=()=>{t.disabled||(i.value.value="",i.value.click())},r=()=>{k()};return o({abort:e=>{Oe(d.value).filter(e?([f])=>String(e.uid)===f:()=>!0).forEach(([f,v])=>{v instanceof XMLHttpRequest&&v.abort(),delete d.value[f]})},upload:w}),(e,n)=>(g(),U("div",{class:y([a(c).b(),a(c).m(e.listType)]),tabindex:"0",onClick:k,onKeydown:re(D(r,["self"]),["enter","space"])},[e.drag?(g(),L(ut,{key:0,disabled:e.disabled,onFile:p},{default:R(()=>[C(e.$slots,"default")]),_:3},8,["disabled"])):C(e.$slots,"default",{key:1}),N("input",{ref_key:"inputRef",ref:i,class:y(a(c).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:$,onClick:n[0]||(n[0]=D(()=>{},["stop"]))},null,42,pt)],42,ct))}}));var le=M(mt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const X="ElUpload",vt=s=>{var o;(o=s.url)!=null&&o.startsWith("blob:")&&URL.revokeObjectURL(s.url)},yt=(s,o)=>{const t=Q([]),c=l=>t.value.find(e=>e.uid===l.uid);function d(l){var e;(e=o.value)==null||e.abort(l)}function i(l=["ready","uploading","success","fail"]){t.value=t.value.filter(e=>!l.includes(e.status))}const p=(l,e)=>{const n=c(e);!n||(n.status="fail",t.value.splice(t.value.indexOf(n),1),s.onError(l,n,t.value),s.onChange(n,t.value))},w=(l,e)=>{const n=c(e);!n||(s.onProgress(l,n,t.value),n.status="uploading",n.percentage=Math.round(l.percent))},S=(l,e)=>{const n=c(e);!n||(n.status="success",n.response=l,s.onSuccess(l,n,t.value),s.onChange(n,t.value))},$=l=>{const e={name:l.name,percentage:0,status:"ready",size:l.size,raw:l,uid:l.uid};if(s.listType==="picture-card"||s.listType==="picture")try{e.url=URL.createObjectURL(l)}catch(n){De(X,n.message),s.onError(n,e,t.value)}t.value.push(e),s.onChange(e,t.value)},k=async(l,e)=>{e&&Be({scope:X,from:"handleRemove second argument",version:"2.2",replacement:"first argument `file`",ref:"https://element-plus.org/en-US/component/upload.html#methods"},!0);const n=e||l,f=n instanceof File?c(n):n;f||G(X,"file to be removed not found");const v=u=>{d(u);const h=t.value;h.splice(h.indexOf(u),1),s.onRemove(u,h),vt(u)};s.beforeRemove?await s.beforeRemove(f,t.value)!==!1&&v(f):v(f)};function r(){t.value.filter(({status:l})=>l==="ready").forEach(({raw:l})=>{var e;return l&&((e=o.value)==null?void 0:e.upload(l))})}return ee(()=>s.listType,l=>{l!=="picture-card"&&l!=="picture"||(t.value=t.value.map(e=>{const{raw:n,url:f}=e;if(!f&&n)try{e.url=URL.createObjectURL(n)}catch(v){s.onError(v,e,t.value)}return e}))}),ee(()=>s.fileList,l=>{for(const e of l)e.uid||(e.uid=de()),e.status||(e.status="success");t.value=l},{immediate:!0,deep:!0}),{abort:d,clearFiles:i,handleError:p,handleProgress:w,handleStart:$,handleSuccess:S,handleRemove:k,submit:r,uploadFiles:t}},gt={name:"ElUpload"},bt=K(F(T({},gt),{props:Je,setup(s,{expose:o}){const t=s,c=je(),d=Ne(),i=J(),{abort:p,submit:w,clearFiles:S,uploadFiles:$,handleStart:k,handleError:r,handleRemove:l,handleSuccess:e,handleProgress:n}=yt(t,i),f=te(()=>t.listType==="picture-card"),v=te(()=>F(T({},t),{onStart:k,onProgress:n,onSuccess:e,onError:r,onRemove:l}));return qe(()=>{$.value.forEach(({url:u})=>{u!=null&&u.startsWith("blob:")&&URL.revokeObjectURL(u)})}),Ae(ie,{accept:He(t,"accept")}),o({abort:p,submit:w,clearFiles:S,handleStart:k,handleRemove:l}),(u,h)=>(g(),U("div",null,[a(f)&&u.showFileList?(g(),L(oe,{key:0,disabled:a(d),"list-type":u.listType,files:a($),"handle-preview":u.onPreview,onRemove:a(l)},se({append:R(()=>[u.listType==="picture-card"?(g(),L(le,ae({key:0,ref_key:"uploadRef",ref:i},a(v)),{default:R(()=>[a(c).trigger?C(u.$slots,"trigger",{key:0}):b("v-if",!0),!a(c).trigger&&a(c).default?C(u.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)):b("v-if",!0)]),_:2},[u.$slots.file?{name:"default",fn:R(({file:_})=>[C(u.$slots,"file",{file:_})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0),u.listType!=="picture-card"?(g(),L(le,ae({key:1,ref_key:"uploadRef",ref:i},a(v)),{default:R(()=>[a(c).trigger?C(u.$slots,"trigger",{key:0}):b("v-if",!0),!a(c).trigger&&a(c).default?C(u.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)):b("v-if",!0),u.$slots.trigger?C(u.$slots,"default",{key:2}):b("v-if",!0),C(u.$slots,"tip"),!a(f)&&u.showFileList?(g(),L(oe,{key:3,disabled:a(d),"list-type":u.listType,files:a($),"handle-preview":u.onPreview,onRemove:a(l)},se({_:2},[u.$slots.file?{name:"default",fn:R(({file:_})=>[C(u.$slots,"file",{file:_})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0)]))}}));var ht=M(bt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Ct=Ke(ht);export{Ct as E};
