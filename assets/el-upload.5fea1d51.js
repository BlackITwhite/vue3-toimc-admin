var me=Object.defineProperty,ve=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var Z=(s,n,t)=>n in s?me(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,P=(s,n)=>{for(var t in n||(n={}))ge.call(n,t)&&Z(s,t,n[t]);if(Y)for(var t of Y(n))be.call(n,t)&&Z(s,t,n[t]);return s},T=(s,n)=>ve(s,ye(n));import{aX as V,aY as he,Y as q,Z as v,$ as K,ah as k,e as H,a9 as ke,v as N,f as G,o as g,g as F,w as R,c as S,C as Ee,z as y,aZ as a,aO as re,J as C,B as b,a as A,b as L,a_ as $e,m as O,t as Q,a7 as D,R as Ce,a$ as Re,a4 as we,b0 as Ue,b1 as Se,b2 as Fe,F as Le,b3 as Pe,y as M,b4 as Te,a0 as _e,b5 as J,b6 as Oe,G as x,aF as De,b7 as Be,b8 as je,x as ee,aJ as Ae,al as Ne,b9 as qe,I as te,K as se,a2 as Ke}from"./index.ae7eb31a.js";import{E as He}from"./el-progress.25126120.js";const ie=Symbol("uploadContextKey"),Me="ElUpload";class ze extends Error{constructor(n,t,d,u){super(n),this.name="UploadAjaxError",this.status=t,this.method=d,this.url=u}}function ae(s,n,t){let d;return t.response?d=`${t.response.error||t.response}`:t.responseText?d=`${t.responseText}`:d=`fail to ${n.method} ${s} ${t.status}`,new ze(d,t.status,n.method,s)}function Ie(s){const n=s.responseText||s.response;if(!n)return n;try{return JSON.parse(n)}catch{return n}}const Xe=s=>{typeof XMLHttpRequest=="undefined"&&V(Me,"XMLHttpRequest is undefined");const n=new XMLHttpRequest,t=s.action;n.upload&&n.upload.addEventListener("progress",i=>{const f=i;f.percent=i.total>0?i.loaded/i.total*100:0,s.onProgress(f)});const d=new FormData;if(s.data)for(const[i,f]of Object.entries(s.data))Array.isArray(f)?d.append(i,...f):d.append(i,f);d.append(s.filename,s.file,s.file.name),n.addEventListener("error",()=>{s.onError(ae(t,s,n))}),n.addEventListener("load",()=>{if(n.status<200||n.status>=300)return s.onError(ae(t,s,n));s.onSuccess(Ie(n))}),n.open(s.method,t,!0),s.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);const u=s.headers||{};if(u instanceof Headers)u.forEach((i,f)=>n.setRequestHeader(f,i));else for(const[i,f]of Object.entries(u))he(f)||n.setRequestHeader(i,String(f));return n.send(d),n},ue=["text","picture","picture-card"];let We=1;const de=()=>Date.now()+We++,ce=q({action:{type:String,default:"#"},headers:{type:v(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>K({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:v(Array),default:()=>K([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ue,default:"text"},httpRequest:{type:v(Function),default:Xe},disabled:Boolean,limit:Number}),Je=q(T(P({},ce),{beforeUpload:{type:v(Function),default:k},beforeRemove:{type:v(Function)},onRemove:{type:v(Function),default:k},onChange:{type:v(Function),default:k},onPreview:{type:v(Function),default:k},onSuccess:{type:v(Function),default:k},onProgress:{type:v(Function),default:k},onError:{type:v(Function),default:k},onExceed:{type:v(Function),default:k}})),Ve=q({files:{type:v(Array),default:()=>K([])},disabled:{type:Boolean,default:!1},handlePreview:{type:v(Function),default:k},listType:{type:String,values:ue,default:"text"}}),Ge={remove:s=>!!s},Ye=["onKeydown"],Ze=["src"],Qe=["onClick"],xe=["onClick"],et=["onClick"],tt={name:"ElUploadList"},st=H(T(P({},tt),{props:Ve,emits:Ge,setup(s,{emit:n}){const t=s,{t:d}=ke(),u=N("upload"),i=N("icon"),f=N("list"),w=G(!1),U=r=>{t.handlePreview(r)},$=r=>{r.target.focus()},h=r=>{n("remove",r)};return(r,l)=>(g(),F(Pe,{tag:"ul",class:y([a(u).b("list"),a(u).bm("list",r.listType),a(u).is("disabled",r.disabled)]),name:a(f).b()},{default:R(()=>[(g(!0),S(Le,null,Ee(r.files,e=>(g(),S("li",{key:e.uid||e.name,class:y([a(u).be("list","item"),a(u).is(e.status),{focusing:w.value}]),tabindex:"0",onKeydown:re(o=>!r.disabled&&h(e),["delete"]),onFocus:l[0]||(l[0]=o=>w.value=!0),onBlur:l[1]||(l[1]=o=>w.value=!1),onClick:$},[C(r.$slots,"default",{file:e},()=>[r.listType==="picture"||e.status!=="uploading"&&r.listType==="picture-card"?(g(),S("img",{key:0,class:y(a(u).be("list","item-thumbnail")),src:e.url,alt:""},null,10,Ze)):b("v-if",!0),r.listType!=="picture"&&(e.status==="uploading"||r.listType!=="picture-card")?(g(),S("div",{key:1,class:y(a(u).be("list","item-info"))},[A("a",{class:y(a(u).be("list","item-name")),onClick:D(o=>U(e),["prevent"])},[L(a(O),{class:y(a(i).m("document"))},{default:R(()=>[L(a($e))]),_:1},8,["class"]),A("span",{class:y(a(u).be("list","item-file-name"))},Q(e.name),3)],10,Qe),e.status==="uploading"?(g(),F(a(He),{key:0,type:r.listType==="picture-card"?"circle":"line","stroke-width":r.listType==="picture-card"?6:2,percentage:Number(e.percentage),style:Ce(r.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):b("v-if",!0)],2)):b("v-if",!0),A("label",{class:y(a(u).be("list","item-status-label"))},[r.listType==="text"?(g(),F(a(O),{key:0,class:y([a(i).m("upload-success"),a(i).m("circle-check")])},{default:R(()=>[L(a(Re))]),_:1},8,["class"])):["picture-card","picture"].includes(r.listType)?(g(),F(a(O),{key:1,class:y([a(i).m("upload-success"),a(i).m("check")])},{default:R(()=>[L(a(we))]),_:1},8,["class"])):b("v-if",!0)],2),r.disabled?b("v-if",!0):(g(),F(a(O),{key:2,class:y(a(i).m("close")),onClick:o=>h(e)},{default:R(()=>[L(a(Ue))]),_:2},1032,["class","onClick"])),b(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),b(" This is a bug which needs to be fixed "),b(" TODO: Fix the incorrect navigation interaction "),r.disabled?b("v-if",!0):(g(),S("i",{key:3,class:y(a(i).m("close-tip"))},Q(a(d)("el.upload.deleteTip")),3)),r.listType==="picture-card"?(g(),S("span",{key:4,class:y(a(u).be("list","item-actions"))},[A("span",{class:y(a(u).be("list","item-preview")),onClick:o=>r.handlePreview(e)},[L(a(O),{class:y(a(i).m("zoom-in"))},{default:R(()=>[L(a(Se))]),_:1},8,["class"])],10,xe),r.disabled?b("v-if",!0):(g(),S("span",{key:0,class:y(a(u).be("list","item-delete")),onClick:o=>h(e)},[L(a(O),{class:y(a(i).m("delete"))},{default:R(()=>[L(a(Fe))]),_:1},8,["class"])],10,et))],2)):b("v-if",!0)])],42,Ye))),128)),C(r.$slots,"append")]),_:3},8,["class","name"]))}}));var oe=M(st,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const at=q({disabled:{type:Boolean,default:!1}}),ot={file:s=>Te(s)},nt=["onDrop","onDragover"],lt={name:"ElUploadDrag"},rt=H(T(P({},lt),{props:at,emits:ot,setup(s,{emit:n}){const t=s,d="ElUploadDrag",u=_e(ie);u||V(d,"usage: <el-upload><el-upload-dragger /></el-upload>");const i=N("upload"),f=G(!1),w=$=>{if(t.disabled)return;f.value=!1;const h=Array.from($.dataTransfer.files),r=u.accept.value;if(!r){n("file",h);return}const l=h.filter(e=>{const{type:o,name:p}=e,m=p.includes(".")?`.${p.split(".").pop()}`:"",c=o.replace(/\/.*$/,"");return r.split(",").map(E=>E.trim()).filter(E=>E).some(E=>E.startsWith(".")?m===E:/\/\*$/.test(E)?c===E.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(E)?o===E:!1)});n("file",l)},U=()=>{t.disabled||(f.value=!0)};return($,h)=>(g(),S("div",{class:y([a(i).b("dragger"),a(i).is("dragover",f.value)]),onDrop:D(w,["prevent"]),onDragover:D(U,["prevent"]),onDragleave:h[0]||(h[0]=D(r=>f.value=!1,["prevent"]))},[C($.$slots,"default")],42,nt))}}));var it=M(rt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const ut=q(T(P({},ce),{fileList:{type:v(Array),default:()=>K([])},beforeUpload:{type:v(Function),default:k},onRemove:{type:v(Function),default:k},onStart:{type:v(Function),default:k},onSuccess:{type:v(Function),default:k},onProgress:{type:v(Function),default:k},onError:{type:v(Function),default:k},onExceed:{type:v(Function),default:k}})),dt=["onKeydown"],ct=["name","multiple","accept"],pt={name:"ElUploadContent",inheritAttrs:!1},ft=H(T(P({},pt),{props:ut,setup(s,{expose:n}){const t=s,d=N("upload"),u=J({}),i=J(),f=e=>{if(e.length===0)return;const{autoUpload:o,limit:p,fileList:m,multiple:c,onStart:E,onExceed:_}=t;if(p&&m.length+e.length>p){_(e,m);return}c||(e=e.slice(0,1));for(const z of e){const B=z;B.uid=de(),E(B),o&&w(B)}},w=async e=>{if(i.value.value="",!t.beforeUpload)return U(e);let o;try{o=await t.beforeUpload(e)}catch{o=!1}if(o===!1){t.onRemove(e);return}let p=e;if(o instanceof Blob){o instanceof File?p=o:p=new File([o],e.name,{type:e.type});for(const m of Object.keys(e))p[m]=e[m]}U(e)},U=e=>{const{headers:o,data:p,method:m,withCredentials:c,name:E,action:_,onProgress:z,onSuccess:B,onError:pe,httpRequest:fe}=t,{uid:I}=e,X={headers:o||{},withCredentials:c,file:e,data:p,method:m,filename:E,action:_,onProgress:j=>{z(j,e)},onSuccess:j=>{B(j,e),delete u.value[I]},onError:j=>{pe(j,e),delete u.value[I]}},W=fe(X);u.value[I]=W,W instanceof Promise&&W.then(X.onSuccess,X.onError)},$=e=>{const o=e.target.files;!o||f(Array.from(o))},h=()=>{t.disabled||(i.value.value="",i.value.click())},r=()=>{h()};return n({abort:e=>{Oe(u.value).filter(e?([p])=>String(e.uid)===p:()=>!0).forEach(([p,m])=>{m instanceof XMLHttpRequest&&m.abort(),delete u.value[p]})},upload:w}),(e,o)=>(g(),S("div",{class:y([a(d).b(),a(d).m(e.listType),a(d).is("drag",e.drag)]),tabindex:"0",onClick:h,onKeydown:re(D(r,["self"]),["enter","space"])},[e.drag?(g(),F(it,{key:0,disabled:e.disabled,onFile:f},{default:R(()=>[C(e.$slots,"default")]),_:3},8,["disabled"])):C(e.$slots,"default",{key:1}),A("input",{ref_key:"inputRef",ref:i,class:y(a(d).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:$,onClick:o[0]||(o[0]=D(()=>{},["stop"]))},null,42,ct)],42,dt))}}));var ne=M(ft,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const le="ElUpload",mt=s=>{var n;(n=s.url)!=null&&n.startsWith("blob:")&&URL.revokeObjectURL(s.url)},vt=(s,n)=>{const t=G([]),d=l=>t.value.find(e=>e.uid===l.uid);function u(l){var e;(e=n.value)==null||e.abort(l)}function i(l=["ready","uploading","success","fail"]){t.value=t.value.filter(e=>!l.includes(e.status))}const f=(l,e)=>{const o=d(e);!o||(o.status="fail",t.value.splice(t.value.indexOf(o),1),s.onError(l,o,t.value),s.onChange(o,t.value))},w=(l,e)=>{const o=d(e);!o||(s.onProgress(l,o,t.value),o.status="uploading",o.percentage=Math.round(l.percent))},U=(l,e)=>{const o=d(e);!o||(o.status="success",o.response=l,s.onSuccess(l,o,t.value),s.onChange(o,t.value))},$=l=>{const e={name:l.name,percentage:0,status:"ready",size:l.size,raw:l,uid:l.uid};if(s.listType==="picture-card"||s.listType==="picture")try{e.url=URL.createObjectURL(l)}catch(o){De(le,o.message),s.onError(o,e,t.value)}t.value.push(e),s.onChange(e,t.value)},h=async l=>{const e=l instanceof File?d(l):l;e||V(le,"file to be removed not found");const o=p=>{u(p);const m=t.value;m.splice(m.indexOf(p),1),s.onRemove(p,m),mt(p)};s.beforeRemove?await s.beforeRemove(e,t.value)!==!1&&o(e):o(e)};function r(){t.value.filter(({status:l})=>l==="ready").forEach(({raw:l})=>{var e;return l&&((e=n.value)==null?void 0:e.upload(l))})}return x(()=>s.listType,l=>{l!=="picture-card"&&l!=="picture"||(t.value=t.value.map(e=>{const{raw:o,url:p}=e;if(!p&&o)try{e.url=URL.createObjectURL(o)}catch(m){s.onError(m,e,t.value)}return e}))}),x(()=>s.fileList,l=>{for(const e of l)e.uid||(e.uid=de()),e.status||(e.status="success");t.value=l},{immediate:!0,deep:!0}),{abort:u,clearFiles:i,handleError:f,handleProgress:w,handleStart:$,handleSuccess:U,handleRemove:h,submit:r,uploadFiles:t}},yt={name:"ElUpload"},gt=H(T(P({},yt),{props:Je,setup(s,{expose:n}){const t=s,d=Be(),u=je(),i=J(),{abort:f,submit:w,clearFiles:U,uploadFiles:$,handleStart:h,handleError:r,handleRemove:l,handleSuccess:e,handleProgress:o}=vt(t,i),p=ee(()=>t.listType==="picture-card"),m=ee(()=>T(P({},t),{onStart:h,onProgress:o,onSuccess:e,onError:r,onRemove:l}));return Ae(()=>{$.value.forEach(({url:c})=>{c!=null&&c.startsWith("blob:")&&URL.revokeObjectURL(c)})}),Ne(ie,{accept:qe(t,"accept")}),n({abort:f,submit:w,clearFiles:U,handleStart:h,handleRemove:l}),(c,E)=>(g(),S("div",null,[a(p)&&c.showFileList?(g(),F(oe,{key:0,disabled:a(u),"list-type":c.listType,files:a($),"handle-preview":c.onPreview,onRemove:a(l)},te({append:R(()=>[c.listType==="picture-card"?(g(),F(ne,se({key:0,ref_key:"uploadRef",ref:i},a(m)),{default:R(()=>[a(d).trigger?C(c.$slots,"trigger",{key:0}):b("v-if",!0),!a(d).trigger&&a(d).default?C(c.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)):b("v-if",!0)]),_:2},[c.$slots.file?{name:"default",fn:R(({file:_})=>[C(c.$slots,"file",{file:_})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0),c.listType!=="picture-card"?(g(),F(ne,se({key:1,ref_key:"uploadRef",ref:i},a(m)),{default:R(()=>[a(d).trigger?C(c.$slots,"trigger",{key:0}):b("v-if",!0),!a(d).trigger&&a(d).default?C(c.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)):b("v-if",!0),c.$slots.trigger?C(c.$slots,"default",{key:2}):b("v-if",!0),C(c.$slots,"tip"),!a(p)&&c.showFileList?(g(),F(oe,{key:3,disabled:a(u),"list-type":c.listType,files:a($),"handle-preview":c.onPreview,onRemove:a(l)},te({_:2},[c.$slots.file?{name:"default",fn:R(({file:_})=>[C(c.$slots,"file",{file:_})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0)]))}}));var bt=M(gt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const $t=Ke(bt);export{$t as E};
